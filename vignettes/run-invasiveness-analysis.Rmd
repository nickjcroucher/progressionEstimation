---
title: "Analysis of invasiveness with a single *S. pneumoniae* dataset"
author: "Nicholas Croucher"
date: 1/6/2021
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{run-invasiveness-analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
options(rmarkdown.html_vignette.check_title = FALSE)
```

The `progressionEstimation` package should first be loaded:

```{r setup}
library(progressionEstimation)
require(tidyverse)
require(magrittr)
require(rstan)
require(bridgesampling)
require(loo)
require(kableExtra)
require(xlsx)
```

The data for analysis is contained within the spreadsheet `s_pneumoniae_netherlands.xlsx`. This is loaded as a data frame without using the `strain` column, which is empty, as only serotypes were ascertained in this study:

```{r Read spreadsheet}

s_pneumoniae_netherlands_df <- progressionEstimation::process_input_xlsx("s_pneumoniae_netherlands.xlsx", use_strain = FALSE)

```

The data frame is then converted to the correct format for analysis with the Bayesian models, using the default subtyping:

```{r Process data frame}

s_pneumoniae_netherlands_data <- progressionEstimation::process_input_data(s_pneumoniae_netherlands_df)

```

We can then fit a model that assumes disease occurs as a Poisson process with a fixed progression rate per unit time (in this, with units of years), $\nu_{j}$, for each serotype $j$. Hence the expected number of disease isolates can be described by:
$$d_{i,j} \sim Pois(\nu_{j}\rho_{i,j}N_{i}t_{i})$$
Where:

* $rho_{i,j}$ is the carriage prevalence in study $i$ (in this case, there is only one study)

* $N_{i}$ is the size of the population under surveillance for disease in study $i$ (adjusted to account for demographic-specific sampling)

* $t_{i}$ is the time interval over which disease surveillance was conducted

```{r Fit Poisson model}

s_pneumoniae_netherlands_data <- progressionEstimation::process_input_data(s_pneumoniae_netherlands_df)

```

